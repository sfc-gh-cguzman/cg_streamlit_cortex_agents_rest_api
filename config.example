# Cortex Agent External Integration Demo - Configuration Examples
#
# This file provides configuration examples for the Cortex Agent application.
# There are two types of configuration needed:
#
# 1. SNOWFLAKE CONNECTION SETTINGS (this file) - Authentication and database connection
# 2. APPLICATION BEHAVIOR SETTINGS (config.py) - Feature flags, timeouts, UI settings
#
# The application will automatically load settings from config.py
# You only need to configure the Snowflake connection settings below.

# =============================================================================
# SNOWFLAKE CONNECTION CONFIGURATION
# =============================================================================
# Choose ONE of the following methods to configure your Snowflake connection:

## Method 1: JSON Configuration (Recommended)
## Create: /Library/Application Support/Snowflake/config.json
{
    "account": "orgname-accountname",
    "user": "your_username", 
    "private_key_path": "/Library/Application Support/Snowflake/rsa_key.p8",
    "warehouse": "your_warehouse",
    "database": "SNOWFLAKE_INTELLIGENCE",
    "schema": "AGENTS"
}

## Method 2: Environment Variables (.env file)
## Create: .env in project directory
SNOWFLAKE_ACCOUNT=orgname-accountname
SNOWFLAKE_USER=your_username
SNOWFLAKE_PRIVATE_KEY_PATH=/Library/Application Support/Snowflake/rsa_key.p8
SNOWFLAKE_WAREHOUSE=your_warehouse
SNOWFLAKE_DATABASE=SNOWFLAKE_INTELLIGENCE
SNOWFLAKE_SCHEMA=AGENTS

## Method 3: Streamlit Secrets (.streamlit/secrets.toml)
## Create: .streamlit/secrets.toml in project directory
[snowflake]
account = "orgname-accountname"
user = "your_username"
private_key_path = "/Library/Application Support/Snowflake/rsa_key.p8"
warehouse = "your_warehouse"
database = "SNOWFLAKE_INTELLIGENCE"  
schema = "AGENTS"

# =============================================================================
# ALTERNATIVE AUTHENTICATION METHODS
# =============================================================================

## Password Authentication (replace private_key_path with):
# JSON: "password": "your_password"
# ENV:  SNOWFLAKE_PASSWORD=your_password  
# TOML: password = "your_password"

## Personal Access Token Authentication (replace private_key_path with):
# JSON: "token": "your_personal_access_token"
# ENV:  SNOWFLAKE_TOKEN=your_personal_access_token
# TOML: token = "your_personal_access_token"

# =============================================================================
# OKTA OAUTH AUTHENTICATION (Recommended for External Users)
# =============================================================================
# 
# Okta OAuth provides enterprise-grade authentication with single sign-on.
# When configured, users will be redirected to Okta for authentication.
#
# PREREQUISITES:
# 1. Create an Okta application (Web Application type)
# 2. Configure redirect URI to match your Streamlit app URL
# 3. Add required scopes: openid, profile, email, session:role-any
# 4. Configure Snowflake External OAuth integration with Okta
#
# For detailed Okta + Snowflake setup instructions, see:
# https://docs.snowflake.com/en/user-guide/oauth-okta

## Method 1: Environment Variables (.env file)
OKTA_ISSUER=https://your-org.okta.com/oauth2/your-auth-server-id
OKTA_CLIENT_ID=your_okta_client_id
OKTA_CLIENT_SECRET=your_okta_client_secret
OKTA_REDIRECT_URI=http://localhost:8501
OKTA_SCOPE=openid profile email session:role-any offline_access

## Method 2: Streamlit Secrets (.streamlit/secrets.toml)
[okta]
issuer = "https://your-org.okta.com/oauth2/your-auth-server-id"
client_id = "your_okta_client_id"
client_secret = "your_okta_client_secret"
redirect_uri = "http://localhost:8501"
scope = "openid profile email session:role-any offline_access"

# OKTA CONFIGURATION NOTES:
# - issuer: Your Okta authorization server URL (found in Okta Admin Console)
# - client_id: Application client ID from Okta
# - client_secret: Application client secret (optional for public clients)
# - redirect_uri: Must match exactly what's configured in Okta
# - scope: OAuth scopes - session:role-any is required for Snowflake
#
# IMPORTANT: The redirect_uri must be registered in your Okta application settings.
# For local development, use: http://localhost:8501
# For production, use your actual application URL

# =============================================================================
# APPLICATION BEHAVIOR CONFIGURATION (config.py)
# =============================================================================
# 
# The following settings are automatically loaded from config.py:
#
# API Settings:
# - API_TIMEOUT_MS = 50000 (50 second timeout)
# - MAX_DATAFRAME_ROWS = 1000 (data display limit)
# - SNOWFLAKE_SSL_VERIFY = True (SSL certificate verification)
#
# Feature Flags:
# - ENABLE_CITATIONS = True (show clickable citations)
# - ENABLE_DEBUG_MODE = True (comprehensive debug interface)
# - SHOW_FIRST_TOOL_USE_ONLY = False (show all tool invocations)
# - ENABLE_FILE_PREVIEW = True (enable file preview capabilities)
# - ENABLE_SUGGESTIONS = True (show follow-up suggestions)
#
# File Processing Configuration:
# - MAX_PDF_PAGES = 2 (maximum pages to display in PDF previews)
#
# UI Configuration:
# - PAGE_TITLE = "Cortex Agent API - Demo"
# - PAGE_ICON = ":material/bolt:"
# - LAYOUT = "wide" (full browser width)
# - SIDEBAR_STATE = "expanded" (show sidebar by default)
# - LOGO_PATH = "img/logo.png"
# - ASSISTANT_AVATAR = ":material/robot_2:"
# - USER_AVATAR = ":material/face:"
#
# Application Identity:
# - ORIGIN_APPLICATION = "ExtAgentApp" (API client identifier)
#
# To customize these settings, edit config.py directly.
# All settings listed above are ACTIVE in the current application.
# Any commented examples in config.py are for future extensibility only.

# =============================================================================
# SYSTEM REQUIREMENTS & SETUP
# =============================================================================

## Python Version: 3.11+ required
## Key Dependencies (from requirements.txt):
# - streamlit>=1.49.0 (UI framework)
# - snowflake-connector-python>=3.5.0 (database connection) 
# - snowflake-snowpark-python>=1.11.0 (session management)
# - structlog>=23.2.0 (professional logging)
# - rich>=13.0.0 (enhanced formatting)
# - watchdog>=6.0.0 (file monitoring)

## Setup Instructions:
## 1. Ensure Python 3.11+ is installed
## 2. Clone/download the complete modular application
## 3. Choose ONE Snowflake connection method above
## 4. Replace "your_*" placeholders with actual values
## 5. For RSA authentication: Place private key at specified path with chmod 600
## 6. Run: ./run_external_app.sh (handles dependencies automatically)
## 7. Access application at: http://localhost:8501

# =============================================================================
# ACCOUNT IDENTIFIER FORMAT WARNING
# =============================================================================
# 
# ⚠️  IMPORTANT: Account Identifier Format
# If your Snowflake account identifier contains underscores, replace them with hyphens.
# 
# Example: 
# ❌ myorg-my_account 
# ✅ myorg-my-account
#
# This applies to all three configuration methods above.

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Common Issues:
# 
# 1. "No Agent Selected" Warning
#    - Verify agents exist in SNOWFLAKE_INTELLIGENCE.AGENTS schema
#    - Check database/schema permissions
#
# 2. Authentication Errors  
#    - Verify account identifier format (no underscores)
#    - Check RSA key permissions: chmod 600 /path/to/rsa_key.p8
#    - Confirm username and account are correct
#
# 3. Connection Issues
#    - Check internet connectivity
#    - Verify Snowflake account URL format
#    - Try alternative authentication method
#
# 4. Missing Dependencies
#    - Run: pip install -r requirements.txt
#    - Ensure Python 3.11+ is installed
#
# 5. Okta OAuth Issues
#    - "State mismatch" error: Clear browser cookies and try again
#    - "Token exchange failed": Verify client_secret is correct
#    - "Invalid redirect_uri": Ensure redirect_uri matches exactly in Okta config
#    - "Insufficient scope": Add session:role-any scope in Okta application
#    - Login loop: Check that Okta External OAuth is configured in Snowflake
#
# Enable Debug Mode in the application sidebar for detailed troubleshooting information.

# =============================================================================
# MODULAR ARCHITECTURE NOTES  
# =============================================================================
#
# This application uses a professional 12-module architecture:
# 
# Entry Point: streamlit_app.py (43 lines) → modules.main.main()
# 
# Core Modules:
# - modules/config/ - Configuration management (loads this file)
# - modules/authentication/ - Token generation and auth handling
# - modules/api/ - Cortex Agent API integration
# - modules/snowflake/ - Client and agent discovery  
# - modules/models/ - Type-safe data structures
# - modules/threads/ - Conversation context management
# - modules/ui/ - Interactive interface components
# - modules/citations/ - Citation processing and display
# - modules/files/ - File handling and preview
# - modules/logging/ - Professional structured logging
# - modules/utils/ - Text processing utilities
# - modules/main/ - Application orchestration
#
# See docs/ folder for comprehensive architecture documentation.